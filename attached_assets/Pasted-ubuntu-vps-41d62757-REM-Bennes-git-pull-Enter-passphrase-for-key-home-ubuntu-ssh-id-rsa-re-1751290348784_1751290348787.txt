ubuntu@vps-41d62757:~/REM-Bennes$ git pull
Enter passphrase for key '/home/ubuntu/.ssh/id_rsa':
remote: Enumerating objects: 10, done.
remote: Counting objects: 100% (10/10), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 7 (delta 3), reused 7 (delta 3), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 3.69 KiB | 472.00 KiB/s, done.
From github.com:PurpleGuys/REM-Bennes
   c48ce36..e613479  main       -> origin/main
Updating c48ce36..e613479
Fast-forward
 attached_assets/Pasted-ubuntu-vps-41d62757-REM-Bennes-docker-compose-logs-f-app-Attaching-to-rem-bennes-app-1-app-1--1751289642086_1751289642089.txt | 1332 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 docker-compose.yml                                                                                                                                   |    3 +
 docker-fix.env                                                                                                                                       |   91 ++++++
 docker-troubleshoot.sh                                                                                                                               |   50 +++
 4 files changed, 1476 insertions(+)
 create mode 100644 attached_assets/Pasted-ubuntu-vps-41d62757-REM-Bennes-docker-compose-logs-f-app-Attaching-to-rem-bennes-app-1-app-1--1751289642086_1751289642089.txt
 create mode 100644 docker-fix.env
 create mode 100644 docker-troubleshoot.sh
ubuntu@vps-41d62757:~/REM-Bennes$ chmod +x docker-troubleshoot.sh
ubuntu@vps-41d62757:~/REM-Bennes$ ./docker-troubleshoot.sh
🔧 Résolution du problème Docker - Erreur de chemin undefined
=============================================================
📦 Arrêt des conteneurs Docker...
Stopping rem-bennes_nginx_1    ... done
Stopping rem-bennes_app_1      ... done
Stopping rem-bennes_postgres_1 ... done
Stopping rem-bennes_redis_1    ... done
Removing rem-bennes_nginx_1    ... done
Removing rem-bennes_app_1      ... done
Removing rem-bennes_postgres_1 ... done
Removing rem-bennes_redis_1    ... done
Removing network rem-bennes_default
🧹 Nettoyage des conteneurs...
Deleted Images:
deleted: sha256:d2396cd3976b6ca18ceacaa8e33d18ee209d79b9c4b6d8562578a1d2093dde79
deleted: sha256:7c82e182aeec13331c68df7c3aceb1f433791ea313cd1442e1f9aab0f28b2a4b
deleted: sha256:8209165a86e966290d2baf2816b848a2310cd449c9c7672e036ab078b557ddcf
deleted: sha256:5ea2d42e21f8f34e31cd237962711fe1ba2738a8d4530899a02598bba9fd176c
deleted: sha256:23769faa8aa733ba50c2c6468f8acfc398f4341a63b4a75b8ce64d92b133d423
deleted: sha256:f37a19365bbad78af4a4e1fab7fead225303dcd39f25bf7d706049957da48d83
deleted: sha256:686e80902b08b2ebbb04df4ff293c1acab02797849a8ee641836633a89050798
deleted: sha256:4d922fec6b354f5cb27d3879d4a29d74ada885cff364af7c86f3ca22694a3a89
deleted: sha256:aa7488946905419a431b433bc83a328e38421dcf5909684d30eb66ba32a2b97f
deleted: sha256:df46eadbc82fd49ff6cb185cb8736228e7d18b840784061a154f1c4a2bea2ae9
deleted: sha256:d61c0b05b93e5659ee36059da2bb737699e956420bceaf21b4ce4fd8f5c62017
deleted: sha256:7e4b7f1cf771743289aa229a2a15e23119261100d14f0e926c0ea3d98829034e
deleted: sha256:d7291039bf414313d7f8f21419b7de3167bd6ea6c3710af0d7a2fc9116026b8b
deleted: sha256:ed1836fc2f1f02ea49808f1cccd9aac12c3fb5ffa4cf18fba8a80dae0954bb56
deleted: sha256:49f9120788dfb6637a7c2122325c3b9c4b5f09988d65feeb930c54235ae1774d
deleted: sha256:7ac71ca99b91ac6ea0cff09a690a6b575449db3f05f15e42cef07d4fbc1aa506
deleted: sha256:360dbdabe9fe906a7447cb77863c653e60ed3fbd5e04c6b316d7e1189f752370
deleted: sha256:ad0995175a5c4f7e407d169e8dc72aebbda1df43f3ea6499684bdecdc5e39093
deleted: sha256:661ea47798b037c27c9fedb4252917614315960fcef90fb51c7247fdb9e40b8b
deleted: sha256:6183bcfa0cd5bc2d05b691bb5e64c94c63b31b9daff7896011faffda1e01a9b5
deleted: sha256:6192021809f8a52ec70b1d6ce4f3a9b3637c85307e9f343fb82dd34b14843d93
deleted: sha256:97a90d79e55a756b1fda629838a6270590d7eeadae402310803be6067a8a83fc
deleted: sha256:908990761287549aef06c3fc590a13a640ba60acdf253e6d77fd2d521a32f2fc
deleted: sha256:f40634c36380ea393fb2aca2bea36ea554e23f64bd165bd73d91c7db8dfcff45
deleted: sha256:60e95ab1a513b0ed096e542f6a0daa82dffc2533e282763e98b99a3cba06ba1f
deleted: sha256:5f5116bfaecc08a524d3f0ba59223c6d0a57b84ed229be162ecd8321e822231b
deleted: sha256:ea43ac557171564beacce9e1dc1564124b0b69c427420d220410e07b1965bf22
deleted: sha256:65f565f56bf9c277018351a20dd07b27f0da3ae903c044a0f5b26d70809ef02b
deleted: sha256:121de2cad6fc15b238f5f5955f158b7f0d1bebb72d091aff88600f79a8a38fa2
deleted: sha256:71e824cd545c1c28e20ecce7086f31d454fb8cfa7a217f9cd2b7948def6e3598
deleted: sha256:650d8a9aad6fde3bf9047bfa01b0102256d9082d6806ce91303ca0bf7647de62
deleted: sha256:dd5ed6ee8aac4eb93ec49ec45422d08887f9496713a810efed37d2473d8af5b7

Total reclaimed space: 1.754GB
📝 Configuration des variables d'environnement...
🔨 Reconstruction de l'image Docker...
postgres uses an image, skipping
redis uses an image, skipping
nginx uses an image, skipping
Building app
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  438.7MB
Step 1/16 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/16 : RUN apk add --no-cache     postgresql-client     curl     && rm -rf /var/cache/apk/*
 ---> Running in 51706b41d236
fetch https://dl-cdn.alpinelinux.org/alpine/v3.21/main/x86_64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.21/community/x86_64/APKINDEX.tar.gz
(1/16) Installing brotli-libs (1.1.0-r2)
(2/16) Installing c-ares (1.34.5-r0)
(3/16) Installing libunistring (1.2-r0)
(4/16) Installing libidn2 (2.3.7-r0)
(5/16) Installing nghttp2-libs (1.64.0-r0)
(6/16) Installing libpsl (0.21.5-r3)
(7/16) Installing zstd-libs (1.5.6-r2)
(8/16) Installing libcurl (8.12.1-r1)
(9/16) Installing curl (8.12.1-r1)
(10/16) Installing postgresql-common (1.2-r1)
Executing postgresql-common-1.2-r1.pre-install
(11/16) Installing lz4-libs (1.10.0-r0)
(12/16) Installing libpq (17.5-r0)
(13/16) Installing ncurses-terminfo-base (6.5_p20241006-r3)
(14/16) Installing libncursesw (6.5_p20241006-r3)
(15/16) Installing readline (8.2.13-r0)
(16/16) Installing postgresql17-client (17.5-r0)
Executing busybox-1.37.0-r12.trigger
Executing postgresql-common-1.2-r1.trigger
* Setting postgresql17 as the default version
WARNING: opening from cache https://dl-cdn.alpinelinux.org/alpine/v3.21/main: No such file or directory
WARNING: opening from cache https://dl-cdn.alpinelinux.org/alpine/v3.21/community: No such file or directory
OK: 19 MiB in 33 packages
 ---> Removed intermediate container 51706b41d236
 ---> 944c734a0a3c
Step 3/16 : WORKDIR /app
 ---> Running in b35294cfa97c
 ---> Removed intermediate container b35294cfa97c
 ---> e00a2478f723
Step 4/16 : COPY package*.json ./
 ---> 885988cd17e8
Step 5/16 : RUN npm ci --only=production
 ---> Running in 97a36538e025
npm warn config only Use `--omit=dev` to omit dev dependencies from the install.

added 504 packages, and audited 505 packages in 18s

71 packages are looking for funding
  run `npm fund` for details

2 vulnerabilities (1 low, 1 high)

To address issues that do not require attention, run:
  npm audit fix

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.4.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.4.2
npm notice To update run: npm install -g npm@11.4.2
npm notice
 ---> Removed intermediate container 97a36538e025
 ---> 8e506b1d9344
Step 6/16 : COPY . .
 ---> 76b51437bd7c
Step 7/16 : RUN mkdir -p logs uploads dist
 ---> Running in 04d7af70e443
 ---> Removed intermediate container 04d7af70e443
 ---> 66d85a4864ee
Step 8/16 : RUN npm run build
 ---> Running in 3d3d66bf8bc5

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.14 building for production...
transforming...
Browserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 3088 modules transformed.
rendering chunks...
computing gzip size...
../dist/public/index.html                                                  1.07 kB │ gzip:   0.61 kB
../dist/public/assets/667966dbb7a2c-bpfull_1749545669321-ZrB703mV.jpg      8.57 kB
../dist/public/assets/Face-B48vgf5s.png                                   11.47 kB
../dist/public/assets/cotédroit-CQvs7IRd.png                              20.17 kB
../dist/public/assets/cotégauche-BHQGJfEo.png                             35.40 kB
../dist/public/assets/22M3 petit man-Cdd_eOPf.png                         94.94 kB
../dist/public/assets/index-UROmFd9v.css                                  92.32 kB │ gzip:  15.59 kB
../dist/public/assets/purify.es-BFmuJLeH.js                               21.93 kB │ gzip:   8.62 kB
../dist/public/assets/index.es-BhlHfi3-.js                               150.57 kB │ gzip:  51.50 kB
../dist/public/assets/html2canvas.esm-CBrSDip1.js                        201.42 kB │ gzip:  48.03 kB
../dist/public/assets/jspdf.es.min-CAc3NJGn.js                           357.69 kB │ gzip: 117.99 kB
../dist/public/assets/index-B6RjP4Vf.js                                1,112.03 kB │ gzip: 296.30 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 15.89s

  dist/index.js  231.3kb

⚡ Done in 32ms
 ---> Removed intermediate container 3d3d66bf8bc5
 ---> f2789c4938f3
Step 9/16 : RUN addgroup -g 1001 -S nodejs
 ---> Running in 8331ab830c51
 ---> Removed intermediate container 8331ab830c51
 ---> 1b09e282a751
Step 10/16 : RUN adduser -S nodejs -u 1001
 ---> Running in 3282982d8bf7
 ---> Removed intermediate container 3282982d8bf7
 ---> 27c7816af300
Step 11/16 : RUN chown -R nodejs:nodejs /app
 ---> Running in 61c97324b933
 ---> Removed intermediate container 61c97324b933
 ---> 4a6d5810c140
Step 12/16 : USER nodejs
 ---> Running in 96d6919563a8
 ---> Removed intermediate container 96d6919563a8
 ---> 0dd565e57db3
Step 13/16 : EXPOSE 5000
 ---> Running in 632bbe0f8a21
 ---> Removed intermediate container 632bbe0f8a21
 ---> a7d87e1222a8
Step 14/16 : ENV NODE_ENV=production
 ---> Running in e7f60707d6a4
 ---> Removed intermediate container e7f60707d6a4
 ---> e3052a372807
Step 15/16 : ENV PORT=5000
 ---> Running in f1cd1d01d5ba
 ---> Removed intermediate container f1cd1d01d5ba
 ---> 15740ccd7f12
Step 16/16 : CMD ["node", "dist/index.js"]
 ---> Running in a9a4328af265
 ---> Removed intermediate container a9a4328af265
 ---> 4fcc5c407a1d
Successfully built 4fcc5c407a1d
Successfully tagged rem-bennes_app:latest
🚀 Démarrage des services...
Creating network "rem-bennes_default" with the default driver
Creating rem-bennes_postgres_1 ... done
Creating rem-bennes_redis_1    ... done
Creating rem-bennes_app_1      ... done
Creating rem-bennes_nginx_1    ... done
⏳ Attente du démarrage des services...
📋 Vérification des logs...
app_1       | Node.js v18.20.8
app_1       | SendGrid email service initialized successfully.
app_1       | SendGrid email service initialized successfully.
app_1       | node:internal/errors:496
app_1       |     ErrorCaptureStackTrace(err);
app_1       |     ^
app_1       |
app_1       | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
app_1       |     at new NodeError (node:internal/errors:405:5)
app_1       |     at validateString (node:internal/validators:162:11)
app_1       |     at Object.resolve (node:path:1115:7)
app_1       |     at file:///app/dist/index.js:5648:18
app_1       |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
app_1       |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
app_1       |     at async loadESM (node:internal/process/esm_loader:34:7)
app_1       |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
app_1       |   code: 'ERR_INVALID_ARG_TYPE'
app_1       | }
app_1       |
app_1       | Node.js v18.20.8
🧪 Test de connectivité...
❌ Application non accessible, vérification des logs...
app_1       |     at new NodeError (node:internal/errors:405:5)
app_1       |     at validateString (node:internal/validators:162:11)
app_1       |     at Object.resolve (node:path:1115:7)
app_1       |     at file:///app/dist/index.js:5648:18
app_1       |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
app_1       |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
app_1       |     at async loadESM (node:internal/process/esm_loader:34:7)
app_1       |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
app_1       |   code: 'ERR_INVALID_ARG_TYPE'
app_1       | }
app_1       |
app_1       | Node.js v18.20.8
app_1       | SendGrid email service initialized successfully.
app_1       | SendGrid email service initialized successfully.
app_1       | node:internal/errors:496
app_1       |     ErrorCaptureStackTrace(err);
app_1       |     ^
app_1       |
app_1       | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
app_1       |     at new NodeError (node:internal/errors:405:5)
app_1       |     at validateString (node:internal/validators:162:11)
app_1       |     at Object.resolve (node:path:1115:7)
app_1       |     at file:///app/dist/index.js:5648:18
app_1       |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
app_1       |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
app_1       |     at async loadESM (node:internal/process/esm_loader:34:7)
app_1       |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
app_1       |   code: 'ERR_INVALID_ARG_TYPE'
app_1       | }
app_1       |
app_1       | Node.js v18.20.8
app_1       | SendGrid email service initialized successfully.
app_1       | SendGrid email service initialized successfully.
app_1       | node:internal/errors:496
app_1       |     ErrorCaptureStackTrace(err);
app_1       |     ^
app_1       |
app_1       | TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string. Received undefined
app_1       |     at new NodeError (node:internal/errors:405:5)
app_1       |     at validateString (node:internal/validators:162:11)
app_1       |     at Object.resolve (node:path:1115:7)
app_1       |     at file:///app/dist/index.js:5648:18
app_1       |     at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
app_1       |     at async ModuleLoader.import (node:internal/modules/esm/loader:337:24)
app_1       |     at async loadESM (node:internal/process/esm_loader:34:7)
app_1       |     at async handleMainPromise (node:internal/modules/run_main:106:12) {
app_1       |   code: 'ERR_INVALID_ARG_TYPE'
app_1       | }
app_1       |
app_1       | Node.js v18.20.8
🔍 Commandes utiles pour le débogage:
- Voir les logs: docker-compose logs -f app
- Redémarrer: docker-compose restart app
- Entrer dans le conteneur: docker-compose exec app sh
